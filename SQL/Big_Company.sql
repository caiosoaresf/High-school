CREATE DATABASE IF NOT EXISTS BIG_COMPANY;
USE BIG_COMPANY;

CREATE TABLE IF NOT EXISTS EMPLOYEE (NOM VARCHAR(25) NOT NULL,CPF VARCHAR(14) NOT NULL, SALARY DOUBLE NOT NULL,ADDRESS VARCHAR(35) NOT NULL,GENDER VARCHAR(10) NOT NULL,DATEBIRTH DATE NOT NULL,CONSTRAINT PRIMARY KEY (CPF));

CREATE TABLE IF NOT EXISTS DEPARTMENT (COD3 varchar(8) NOT NULL,NOM varchar(35) NOT NULL,DepADMINISTERED varchar(14) NOT NULL,CONSTRAINT PRIMARY KEY (COD3),CONSTRAINT fk_DepMANAGER FOREIGN KEY (DepADMINISTERED) REFERENCES EMPLOYEE(CPF) ON DELETE RESTRICT);

CREATE TABLE IF NOT EXISTS PROJECT (TITLE VARCHAR(25) NOT NULL,COD3 DOUBLE NOT NULL,PL4CE VARCHAR(35) NOT NULL,CodDEPARTMENT varchar(8) NOT NULL,CONSTRAINT PRIMARY KEY (TITLE, COD3),CONSTRAINT fk_Project foreign key (CodDEPARTMENT) references DEPARTMENT(COD3) On delete restrict);

CREATE TABLE IF NOT EXISTS DEPENDANT (NOM varchar(35) NOT NULL,GENDER VARCHAR(10) NOT NULL,DATEBIRTH DATE NOT NULL,CPFRELATIVE VARCHAR(14) NOT NULL,CONSTRAINT PRIMARY KEY (NOM,CPFRELATIVE),CONSTRAINT fk_DEPENDANT FOREIGN KEY (CPFRELATIVE) REFERENCES EMPLOYEE(CPF) ON DELETE RESTRICT);

CREATE TABLE IF NOT EXISTS ADDRESSES (COD3Dep varchar (8) NOT NULL,ADDRESSDep varchar(25) NOT NULL,CONSTRAINT PRIMARY KEY(COD3Dep),CONSTRAINT fk_ADDRESSES FOREIGN KEY(COD3Dep) REFERENCES DEPARTMENT(COD3) ON DELETE CASCADE);

CREATE TABLE IF NOT EXISTS EMPLOYEEWORKSDEPARTMENT (COD3Dep VARCHAR(8) NOT NULL,CPFEmp VARCHAR(14) NOT NULL,CONSTRAINT PRIMARY KEY(COD3Dep, CPFEmp),CONSTRAINT fk_WorksDEPARTMENT_receives FOREIGN KEY (COD3Dep) REFERENCES DEPARTMENT (COD3) ON DELETE RESTRICT,CONSTRAINT fk_EMPLOYEE_receives FOREIGN KEY (CPFEmp) REFERENCES EMPLOYEE(CPF) ON DELETE RESTRICT);

CREATE TABLE IF NOT EXISTS EMPLOYEEWORKSPROJECT (CPFEmp VARCHAR(14) NOT NULL,TITLEPROJECT VARCHAR(35) NOT NULL,COD3PROJECT DOUBLE NOT NULL,CONSTRAINT PRIMARY KEY (CPFEmp,TITLEPROJECT,COD3PROJECT),CONSTRAINT fk_ProjEMPLOYEE_receives FOREIGN KEY (CPFEmp) REFERENCES EMPLOYEE(CPF) ON DELETE RESTRICT,CONSTRAINT fk_PROJECT_receives FOREIGN KEY (TITLEPROJECT, COD3PROJECT) REFERENCES PROJECT(TITLE, COD3) ON DELETE RESTRICT);

INSERT INTO EMPLOYEE VALUES ( "Seiya", "11111111111111", 150000.00, "Rua Pegasus", "Masculino", date_format('1972-12-01', '%Y-%m-%d'));
INSERT INTO EMPLOYEE VALUES ( "Shiryu", "22222222222222", 15000.00, "Rua Dragão", "Masculino", date_format('1971-10-04', '%Y-%m-%d'));
INSERT INTO EMPLOYEE VALUES ( "Shun", "33333333333333", 15000.00, "Rua Andrômeda", "Masculino", date_format('1972-09-09', '%Y-%m-%d'));
INSERT INTO EMPLOYEE VALUES ( "Hyoga", "44444444444444", 15000.00, "Rua Cisne", "Masculino", date_format('1971-01-23', '%Y-%m-%d'));
INSERT INTO EMPLOYEE VALUES ( "Ikki", "55555555555555", 15000.00, "Rua Fenix", "Masculino", date_format('1970-08-15', '%Y-%m-%d'));

INSERT INTO DEPARTMENT VALUES ("Dep01", "DEPARTMENT 1","11111111111111");
INSERT INTO DEPARTMENT VALUES ("Dep02", "DEPARTMENT 2","22222222222222");
INSERT INTO DEPARTMENT VALUES ("Dep03", "DEPARTMENT 3","33333333333333"); 
INSERT INTO DEPARTMENT VALUES ("Dep04", "DEPARTMENT 4","44444444444444");
INSERT INTO DEPARTMENT VALUES ("Dep05", "DEPARTMENT 5","55555555555555");

INSERT INTO PROJECT VALUES ( "PROJECTA", 123, "Rua Sagitario","Dep01");
INSERT INTO PROJECT VALUES ( "PROJECTB", 234, "Rua Libra","Dep02");
INSERT INTO PROJECT VALUES ( "PROJECTC", 345, "Rua Virgem","Dep03");
INSERT INTO PROJECT VALUES ( "PROJECTD", 456, "Rua Aquário","Dep04");
INSERT INTO PROJECT VALUES ( "PROJECTE", 567, "Rua Leão","Dep05");

INSERT INTO DEPENDANT VALUES ("Marin","Feminino", date_format('1969-03-18', '%Y-%m-%d'), "11111111111111");
INSERT INTO DEPENDANT VALUES ("Dohko de Libra","Masculino", date_format('1725-10-20', '%Y-%m-%d'), "22222222222222");
INSERT INTO DEPENDANT VALUES ("Daidalos","Masculino", date_format('1967-04-30', '%Y-%m-%d'), "33333333333333");
INSERT INTO DEPENDANT VALUES ("Camus de Aquário","Masculino", date_format('1966-02-07', '%Y-%m-%d'), "44444444444444");
INSERT INTO DEPENDANT VALUES ("Guilty","Feminino", date_format('1950-08-30', '%Y-%m-%d'), "55555555555555");

# Q1
INSERT INTO EMPLOYEEWORKSPROJECT VALUES ("11111111111111","PROJECTA", 123);
INSERT INTO EMPLOYEEWORKSPROJECT VALUES ("11111111111111","PROJECTC", 345);
INSERT INTO EMPLOYEEWORKSPROJECT VALUES ("22222222222222","PROJECTA", 123);
INSERT INTO EMPLOYEEWORKSPROJECT VALUES ("22222222222222","PROJECTB", 234);
INSERT INTO EMPLOYEEWORKSPROJECT VALUES ("22222222222222","PROJECTD", 456);
INSERT INTO EMPLOYEEWORKSPROJECT VALUES ("33333333333333","PROJECTE", 567);
INSERT INTO EMPLOYEEWORKSPROJECT VALUES ("44444444444444","PROJECTB", 234);
INSERT INTO EMPLOYEEWORKSPROJECT VALUES ("44444444444444","PROJECTE", 567);

# Q2
INSERT INTO EMPLOYEEWORKSDEPARTMENT VALUES ("Dep01","11111111111111");
INSERT INTO EMPLOYEEWORKSDEPARTMENT VALUES ("Dep02","22222222222222");
INSERT INTO EMPLOYEEWORKSDEPARTMENT VALUES ("Dep03","33333333333333");
INSERT INTO EMPLOYEEWORKSDEPARTMENT VALUES ("Dep04","44444444444444");
INSERT INTO EMPLOYEEWORKSDEPARTMENT VALUES ("Dep05","55555555555555");

Select e.NOM, d.NOM
from EMPLOYEE e, DEPARTMENT d, PROJECT p, EMPLOYEEWORKSPROJECT etp, EMPLOYEEWORKSDEPARTMENT etd
where e.cpf = etd.CPFEmp and
	  etd.COD3Dep = d.COD3 and
      etp.CPFemp = e.cpf and
      etp.COD3PROJECT = p.COD3 and
      p.CodDEPARTMENT = d.COD3
group by e.NOM, d.NOM;

# Q3
INSERT INTO DEPENDANT VALUES ("Athena","Feminino", date_format('1973-09-01', '%Y-%m-%d'), "11111111111111");
INSERT INTO DEPENDANT VALUES ("Grande Mestre","Masculino", date_format('1958-05-30', '%Y-%m-%d'), "55555555555555");

Select e.NOM, (select count(*) from EMPLOYEEWORKSPROJECT etp where e.cpf = etp.cpfemp) as "PROJECT WORKS"
from EMPLOYEE e, DEPENDANT dep
where e.cpf = dep.cpfRELATIVE
group by e.NOM
having count(dep.cpfRELATIVE) > 1;

#Q4
#Select1 : EMPLOYEE DEPARTMENT ADNIMISTRATED  DEPENDANT:
select e.NOM, d.NOM, dep.NOM
from EMPLOYEE e, DEPARTMENT d, DEPENDANT dep
where e.cpf = d.depADMINISTERED and
e.cpf = dep.cpfRELATIVE
group by e.NOM;

#Select2 : EMPLOYEE DEPARTMENT ADNIMISTRATED PROJECT WORKS:
select e.NOM as EMPLOYEE,
(select count(d.COD3) from DEPARTMENT d where d.depADMINISTERED = e.cpf) as DEPARTMENT_ADMINISTERED,
(select count(etp.COD3PROJECT) from EMPLOYEEWORKSPROJECT etp where etp.cpfemp = e.cpf) as PROJECT_WORKS
from EMPLOYEE e
group by e.NOM;
